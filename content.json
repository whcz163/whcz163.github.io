[{"title":"字符设备驱动程序","date":"2017-09-18T03:04:51.000Z","path":"2017/09/18/字符设备驱动程序/","text":"字符设备驱动大概步奏； 一个linux内核字符串驱动一般由以下几个部分组成：驱动程序包含的一些必须的头文件12345678910#include &lt;linux/module.h&gt;#include &lt;linux/kernel.h&gt;#include &lt;linux/fs.h&gt;#include &lt;linux/init.h&gt;#include &lt;linux/delay.h&gt;#include &lt;asm/uaccess.h&gt;#include &lt;asm/irq.h&gt;#include &lt;asm/io.h&gt;#include &lt;asm/arch/regs-gpio.h&gt;#include &lt;asm/hardware.h&gt; 程序包含的一些函数，想想具体后面补充12345678910111213141516171819202122232425262728293031323334353637static struct class *firstdrv_class;static struct class_device *firstdrv_class_dev;volatile unsigned long *gpfcon = NULL;volatile unsigned long *gpfdat = NULL;static int first_drv_open(struct inode *inode, struct file *file)&#123; //printk(\"first_drv_open\\n\"); /* 配置GPF4,5,6为输出 */ *gpfcon &amp;= ~((0x3&lt;&lt;(4*2)) | (0x3&lt;&lt;(5*2)) | (0x3&lt;&lt;(6*2))); *gpfcon |= ((0x1&lt;&lt;(4*2)) | (0x1&lt;&lt;(5*2)) | (0x1&lt;&lt;(6*2))); return 0;&#125;static ssize_t first_drv_write(struct file *file, const char __user *buf, size_t count, loff_t * ppos)&#123; int val; //printk(\"first_drv_write\\n\"); copy_from_user(&amp;val, buf, count); // copy_to_user(); if (val == 1) &#123; // 点灯 *gpfdat &amp;= ~((1&lt;&lt;4) | (1&lt;&lt;5) | (1&lt;&lt;6)); &#125; else &#123; // 灭灯 *gpfdat |= (1&lt;&lt;4) | (1&lt;&lt;5) | (1&lt;&lt;6); &#125; return 0;&#125; 模块参数，或者宏变量结构体，或对应驱动的设备表，12345static struct file_operations first_drv_fops = &#123; .owner = THIS_MODULE, /* 这是一个宏，推向编译模块时自动创建的__this_module变量 */ .open = first_drv_open, .write = first_drv_write, &#125;; 模块加载函数：通过insmod加载驱动时候，模块的加载函数会自动被内核执行，完成模块的初始化工作；12345static int hello_init(void)&#123; /**初始化代码**/&#125;module_init(hello_init); 模块卸载函数：当通过rmmod命令卸载某模块时，模块的卸载函数会被自动被内核执行，完成模块的卸载功能；12345static void hello_exit(void)&#123; /**释放代码**/&#125;module_exit(hello_exit); 模块的许可证声明：程序需要遵循GPL兼容许可，以及其它等等…最常用的如下：1MODULE_LICENSE(\"GPL\"); 驱动模块 加载分为 静态加载和动态加载。静态加载是在编译内核的时候，就编译进内核，开机后会自动加载。动态加载是将驱动编译成模块，使用insmod命令加载。加到启动脚本里让其开机自动加载，算是一种技巧，不是标准的方法。二期毕业班，记不到了。 本作品采用知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议进行许可，欢迎转载，但转载请注明来自 www.cetiic.cn ，并保持转载后文章内容的完整。本人保留所有版权相关权利。","tags":[{"name":"2440驱动","slug":"2440驱动","permalink":"http://yoursite.com/tags/2440驱动/"}]},{"title":"博文建设常用模板知识","date":"2017-09-18T03:04:51.000Z","path":"2017/09/18/模板/","text":"#目录隐藏：1&lt;!-- more --&gt; #tags：12345678menu: 主 页: / 博 客: /tags/搞github心得 随 笔: /tags/心随意动 基 础: /tags/linux平台搭建 驱 动: /tags/2440驱动 单片机: /tags/单片机研究 硬 件: /tags/硬件项目 #空格：1&amp;nbsp #居中1&lt;p align=\"center\"&gt;居中字体内容 本作品采用知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议进行许可，欢迎转载，但转载请注明来自 www.cetiic.cn ，并保持转载后文章内容的完整。本人保留所有版权相关权利。","tags":[]},{"title":"insmod驱动之前的工作","date":"2017-09-14T13:59:51.000Z","path":"2017/09/14/insmod驱动之前的工作/","text":"&nbsp;&nbsp;&nbsp;&nbsp;根据自己的思路理解，我本应该直接搞驱动，奈何不停的回到平台搭建部分。insmod驱动之前需要挂载nfs，挂载这个无非就是想把电脑的.ko搞到开发板上加载，但是nfs挂载的前提就是开发板和ubunt的互通。那么问题又来了我电脑的ip和开发板的不在一个网段上，我又不愿意电脑和开发板直连，修改电脑ip迎合开发板。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;所以，有了这篇文章，对我来说意义很大，抽空补全 NFS 启动时候出现的问题 &nbsp;&nbsp;&nbsp;&nbsp;其实我想要搞定的问题很简单，就是一个简单的NFS自动挂载。可是自己不会搞，别人也不一定会，或者会并不知道你要搞什么，所以浪费了不少时间； nfs无法启动 原因1简单粗暴点 就是搞驱动的时候无法insmod 解决办法1手动挂载：1$ mount -t nfs -o nolock 172.18.1.164:/work/nfs_root /tmp 注意：nolock是非阻塞方式；172.18.1.164 是我ubunt的ip，:/work/nfs_root是ubunt上需要挂载的文件夹目录，%%%注意 /tmp， /tmp之前有空格，你不注意肯定搞不定，这个是2440板子上的文件目录，挂载到这里 解决办法2nfs自动挂载 123456789101112nfs启动时出现IP-Config: Complete:device=eth0, addr=192.168.0.100, mask=255.255.255.0, gw=192.168.0.1, host=192.168.0.100, domain=, nis-domain=(none), bootserver=192.168.0.133, rootserver=192.168.0.133, rootpath=Looking up port of RPC 100003/2 on 192.168.0.133Looking up port of RPC 100005/1 on 192.168.0.133VFS: Mounted root (nfs filesystem).Freeing init memory: 140Kinit started: BusyBox v1.7.0 (2008-01-22 10:04:09 EST)starting pid 765, tty '': '/etc/init.d/rcS'nfs: server 192.168.0.133 not responding, still trying 这个只是示意，starting pid 765, tty ‘’: ‘/etc/init.d/rcS’nfs: server 192.168.0.133 not responding, still trying 出现这个现象，根本原因：虚拟机里提供的网络文件系统中的 /work/nfs_roots/xxx/etc/init.d/rcS 有一句修改开发板ip的指令：ifconfig eth0 192.168.1.17 nfs 启动的原理，这里简单讲一下，我们在 boot 中设置了 bootargs 参数，例如：bootargs noinitrd root=/dev/nfs console=ttySAC0 nfsroot=192.168.1.101:/work/nfs_root/fs_mini_mdev ip=192.168.1.253:192.168.1.101:192.168.1.1:255.255.255.0::eth0:off init=/linuxrc 在这里我们指定了开发板ip,主机（虚拟机）ip等信息，在uboot启动内核时会将这些信息传递给内核，内核在启动过程中会根据这些参数来挂载网络根文件系统（位于虚拟机的 nfs_root 目录下），挂载成功之后才会访问 /etc/init.d/rcS 。也就是说，在内核启动的过程中开发板ip已经根据 Bootargs 里指定的Ip设置完毕 ,nfs 启动后我们无需在 /etc/init.d/rcS 中再次更改一次ip，一旦更改了ip 还不在一个网段的话，就会出现上面的这种情况。 解决办法，更改你所设置的网络文件系统目录下的 /etc/init.d/rcS 中的修改ip 的指令即可。举例：/work/nfs_root/fs_mini_mdev/etc/init.d/rcS 遗留的问题当然 还有很多遗留问题，这里不关注，那是后面需要解决的问题，不然无外援，寸步难行。 其它常用开发板ping 设置ping包的次数1&amp;ping -c 6 ip 居中1234567891011121314&lt;html&gt;&lt;head&gt;&lt;title&gt;我的青春&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p align=\"center\"&gt;我的青春 &lt;/p &gt;&lt;body&gt;&lt;/html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;我的青春&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p align=\"center\"&gt;我的青春 &lt;/p &gt;&lt;body&gt;&lt;/html&gt;&lt;body&gt;&lt;p align=\"center\"&gt;我的青春 &lt;/p &gt;&lt;body&gt;&lt;p align=\"center\"&gt;我的青春 空格1&amp;nbsp 本作品采用知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议进行许可，欢迎转载，但转载请注明来自 www.cetiic.cn ，并保持转载后文章内容的完整。本人保留所有版权相关权利。","tags":[{"name":"linux平台搭建","slug":"linux平台搭建","permalink":"http://yoursite.com/tags/linux平台搭建/"}]},{"title":"'建立博客的初衷'","date":"2017-09-14T13:18:20.000Z","path":"2017/09/14/建立博客的初衷/","text":"&nbsp;&nbsp;&nbsp;&nbsp;咨询hceng linux的时候，发现其使用github，并督促自己学习驱动。感觉自己也可以这么干，还可以绑定一个域名玩玩。把自己的缺点尽情的暴露出来。这样才能有更大的进步。 本作品采用知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议进行许可，欢迎转载，但转载请注明来自 www.cetiic.cn ，并保持转载后文章内容的完整。本人保留所有版权相关权利。","tags":[{"name":"心随意动","slug":"心随意动","permalink":"http://yoursite.com/tags/心随意动/"}]},{"title":"github pages","date":"2017-09-10T11:08:17.000Z","path":"2017/09/10/github-pages/","text":"非软件出身，并特别粗心的我，在建github的过程中遇到了一定的困难。关于这两天搞 github遇到了不少问题，开始的完全不懂，慢慢的的感觉就这么回事。有#hceng的好心帮助，也有@闻道的帮助与讽刺及@Маленький гриб的调侃。等手头的事情告一段落，我会把建站一路中遇到的问题，及正确的步骤做一份详细的文档。留念 本作品采用知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议进行许可，欢迎转载，但转载请注明来自 www.cetiic.cn ，并保持转载后文章内容的完整。本人保留所有版权相关权利。","tags":[{"name":"搞github心得","slug":"搞github心得","permalink":"http://yoursite.com/tags/搞github心得/"}]},{"title":"Hello World","date":"2017-09-10T02:38:00.810Z","path":"2017/09/10/hello-world/","text":"Welcome to Hexo!This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment 本作品采用知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议进行许可，欢迎转载，但转载请注明来自 www.cetiic.cn ，并保持转载后文章内容的完整。本人保留所有版权相关权利。","tags":[]}]